<!DOCTYPE html>

<html>

<title>
  This is a title.
</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>


var HttpClient = function() {
  this.get = function(aUrl,aCallback){
    var anHttpRequest = new XMLHttpRequest();
    anHttpRequest.onreadystatechange = function() {
      if (anHttpRequest.readyState == 4 && anHttpRequest.status == 200)
          aCallback(anHttpRequest.responseText);
          //console.log("This is a thing",anHttpRequest.responseText);
    }

    anHttpRequest.open( "GET",aUrl, true );
    anHttpRequest.send( null );
    //console.log(anHttpRequest.responseText);
    //return(response);
  }
}


var tempJson = {"points": [{"env_brightness":1000,"led_brightness":100},{"env_brightness":800,"led_brightness":80},{"env_brightness":100,"led_brightness":10}]};

var client = new HttpClient();
// client.get("http://localhost:8000", function(response) {
//   console.log();
// });

var populateData = function(addr,data){
  var mydata = [];
  client.get(addr,function(response){
    mydata = response;
  });
  console.log(mydata);
  return(mydata);
};

var customParse = function (mystring){
  var newString = "";
  for (var i = 0; i < mystring.length; i++) {
    //console.log(mystring[i]=="'");
    if (mystring[i]=="'") {
      newString = newString.concat("\"");
    } else {
      newString = newString.concat(mystring[i]);
    }
  }
  return(newString);
}

//var dataPoints = [];

window.setInterval(function(){
  var temp;
  //temp = populateData("http://localhost:8000",dataPoints);
  //console.log((temp));
  console.log(tempJson.points);
  for (var i = 0; i < tempJson.points.length; i++) {
    console.log("Point: ", JSON.stringify(tempJson.points[i]));
  };
},2000);

var newPoint = function(x,y,tempJson){
  console.log("Mouse X: ",x,"\tMouse Y: ",y);
  if (tempJson.points.length == 5) {
    // find closest point based on X
    console.log("dataPoints are full");
  } else {
    console.log("Adding dataPoints");
    tempJson.points.push(Object.freeze({"env_brightness": x, "led_brightness": y}));
  };
  for (var i = 0; i < tempJson.points.length; i++) {
    console.log("Data point",i,"has x: ",tempJson.points[i].env_brightness,"\ty: ",tempJson.points[i].led_brightness);
  }
};

$(document).ready(function(){
  $(".graph").click(function(){
    var x = event.clientX;
    var y = event.clientY;
    newPoint(x,y,tempJson);
  });
});

</script>

<style>

.graph {
  background-color: Tomato;
  color: Blue;
  height: 200px;
  width: 300px;
  margin-left: 20px;
  margin-top: 20px;
}

</style>

<head>
</head>

<body>
  <div class="graph">

  </div>


</body>

</html>
