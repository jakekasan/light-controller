<!DOCTYPE html>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.16/p5.js"></script>
    <script>

    $(document).ready(function(){

      $('form').on('submit',function(){

        var item = $('form input').val().split(/[;,./+\n\s\t:]/);
        console.log(item);
        var value = {'env_brightness': item[0],'led_brightness': item[1]};

        $.ajax({
          type: 'POST',
          url: '/data',
          data: value,
          success: function(data){
            // do something with the data
            console.log("[POST] Request Successful");
            location.reload();
          },
          error: function (error){
            console.log("[POST] Request Failed");
          }
        });

        return false;


      });

      // $('li').on('click', function(){
      //   var item = $(this).text().replace(/ /g, "-");
      //   $.ajax({
      //     type: 'DELETE',
      //     url: '/todo/'
      //   })
      // })


    });

    </script>
  </head>
  <body>
    <h1>This is a heading</h1>
    <div id="light-table">
      <form>
        <input type="text" name="item" placeholder="Type something here..." required />
        <button type="submit">Add value</button>
      </form>
      <ul>
        <% for(var i=0; i < mydata.length; i++){ %>
          <li>Env:  <%= mydata[i].env_brightness %> Led: <%= mydata[i].led_brightness %> </li>
        <% } %>


      </ul>
    <div id='light-graph'>

    </div>
    <script>

    var sketch = function(p) {
      p.setup = function(){
        p.createCanvas(500,500);
        p.background(0);
      };
      p.draw = function() {

      };
    };
    var mygraph = new p5(sketch, 'light-graph');

    mygraph.sketch.p.draw = function() {
      p.fill(255);
      p.stroke(255);
      p.ellipse(100,100,10,10);
    };

    $.getJSON( "/data/json", function(data){
      $.each(data, function(key,val){
        console.log("Key: " + key + "\tValue: " + val);
        p.draw = function(){
          // var data = [{'env_brightness':100,'led_brightness':80},{'env_brightness':75,'led_brightness':60},{'env_brightness':50,'led_brightness':40},{'env_brightness':25,'led_brightness':20}];
          // for (var i = 0; i < data.length; i++) {
          //   var x = map(data[i].env_brightness,0,100,0,width);
          //   var y = map(data[i].led_brightness,0,100,height,0);
          //   p.fill(255);
          //   p.stroke(255);
          //   p.ellise(x,y,8,8);
          // }
        };
      });
    });



    </script>

  </body>
</html>
